# re-test 2
global
    log /dev/log	local0
    log /dev/log	local1 notice
    chroot /var/lib/haproxy
    stats socket /run/haproxy/admin.sock mode 660 level admin expose-fd listeners
    stats timeout 30s
    user haproxy
    group haproxy
    daemon

    # Default SSL material locations
    ca-base /etc/ssl/certs
    crt-base /etc/ssl/private

    # See: https://ssl-config.mozilla.org/#server=haproxy&server-version=2.0.3&config=intermediate
    ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
    ssl-default-bind-ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256
    ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets
    ssl-dh-param-file /etc/haproxy/dhparams.pem

    nbthread 8

defaults
    log	        global
    mode        http
    option      httplog
    option      dontlognull
    option      forwardfor
    timeout     connect 5000
    timeout     client  50000
    timeout     server  50000
    timeout     tunnel        3600s
    timeout     http-keep-alive  1s
    timeout     http-request    15s
    timeout     queue           30s
    timeout     tarpit          60s
    errorfile   400 /etc/haproxy/errors/400.http
    errorfile   403 /etc/haproxy/errors/403.http
    errorfile   408 /etc/haproxy/errors/408.http
    errorfile   500 /etc/haproxy/errors/500.http
    errorfile   502 /etc/haproxy/errors/502.http
    errorfile   503 /etc/haproxy/errors/503.http
    errorfile   504 /etc/haproxy/errors/504.http

listen stats1
    bind *:8080
    mode http
    stats enable
    stats uri /
    stats refresh 30s

frontend stats
    bind *:8404
    http-request use-service prometheus-exporter if { path /metrics }
    stats enable
    stats uri /stats
    stats refresh 30s

frontend http
    bind *:80
    acl letsencrypt-acl path_beg -i /.well-known/acme-challenge
    use_backend letsencrypt-backend if letsencrypt-acl

listen kafka-schema-registry
    bind *:32007
    option tcpka
    option tcplog
    mode tcp
    balance             roundrobin
    server              k8s-prod01-worker01 10.48.14.21:32007 ssl verify none
    server              k8s-prod01-worker02 10.48.14.22:32007 ssl verify none
    server              k8s-prod01-worker03 10.48.14.23:32007 ssl verify none
    server              k8s-prod01-worker04 10.48.14.24:32007 ssl verify none

listen elasticsearch-TCP-9200
    bind *:9200
    mode tcp
    option tcpka
    option tcplog
    option redispatch
    option httpchk GET / HTTP/1.0\r\nAuthorization:\ Basic\ ZWxhc3RpYzpzS2lNdkh3Q0lUU2tnTTJjRlFDWktnVGk=
    timeout server 15m

    balance             roundrobin
    server              k8s-prod01-worker01 10.48.14.21:31200 ssl verify none
    server              k8s-prod01-worker02 10.48.14.22:31200 ssl verify none
    server              k8s-prod01-worker03 10.48.14.23:31200 ssl verify none
    server              k8s-prod01-worker04 10.48.14.24:31200 ssl verify none


frontend https
    bind :80
    bind *:443 ssl crt /etc/ssl/datx/
    http-request redirect scheme https unless { ssl_fc }
    # reqadd X-Forwarded-Proto:\ https
    #http-request add-header X-Forwarded-Proto: https
    mode http

    #Web portal datx.com.vn
    acl         datx_com_vn             hdr(host)      -i datx.com.vn
    acl         www_datx_com_vn         hdr(host)      -i www.datx.com.vn

    # redirect    prefix https://datx.com.vn  code 301 if www_datx_com_vn

    # Test URI to see if its a letsencrypt request
    acl letsencrypt-acl path_beg -i /.well-known/acme-challenge
    use_backend letsencrypt-backend if letsencrypt-acl

    #Block all request to env path
    acl block_env_path              path_beg                        /.env
    http-request                    deny                            if  block_env_path

    #Whitelist IPs
    acl whitelist src -f /etc/haproxy/whitelist.acl

    ########################################Xwealth Vender Mainenance#########################################
    #  http-request redirect  code 302  location  https://maintenance.datx.vn/index.html if { hdr(host) -i xwealth.bvote.vn }      !whitelist
    #  http-request redirect  code 302  location  https://maintenance.datx.vn/index.html if { hdr(host) -i xwealth.f247.com }      !whitelist
    #  http-request redirect  code 302  location  https://maintenance.datx.vn/index.html if { hdr(host) -i xwealth.vixs.v }        !whitelist
    #  http-request redirect  code 302  location  https://maintenance.datx.vn/index.html if { hdr(host) -i ps-ai.psi.vn }          !whitelist
       http-request redirect  code 302  location  https://crm-v2.datxstg.com/            if { hdr(host) -i dev-crm-v2.datxstg.com } 
    ######################################################################################################

    # K8S Ingress Nginx
    acl prod_datx_components                        hdr(host)                               -i      datx-components.datxasia.com
    use_backend                                     backend_prod_ingress_nginx_http          if      prod_datx_components

    acl prod_api_partners                           hdr(host)                               -i      api-partners.datx.vn
    use_backend                                     backend_prod_ingress_nginx_http          if      prod_api_partners

    ### ====================
    ##Sendgird Webhook
    acl sendgird_webhook_service hdr(host) -i sendgird-webhook.datx.vn
    use_backend backend_sendgird_webhook if sendgird_webhook_service

    ### tradingview

    # production
    acl prod_tradingview hdr(host) 	-i tradingview.datx.vn
    use_backend backend_prod_tradingview 	if prod_tradingview

    # beta

    acl beta_tradingview hdr(host) 	-i beta-tradingview.datxstg.com
    use_backend backend_beta_tradingview 	if beta_tradingview

    acl beta_tradingview_datxasia hdr(host) 	-i beta-tradingview.datxasia.com
    use_backend backend_beta_tradingview 	if beta_tradingview_datxasia


    ### ====================
    ### tradingview-wrapper / charts

    # production
    acl prod_charts hdr(host) 		-i charts.datx.vn
    use_backend backend_prod_charts 		if prod_charts

    # beta
    acl beta_charts hdr(host) 		-i beta-charts.datxstg.com
    use_backend backend_beta_charts 		if beta_charts

    acl beta_charts_datxasia hdr(host) 		-i beta-charts.datxasia.com
    use_backend backend_beta_charts 		if beta_charts_datxasia

    ### ====================
    # trading-view-api

    # production
    acl prod_trading_view_api hdr(host) -i trading-view-api.datxstg.com
    acl prod_trading_view_api_datxvn hdr(host) -i trading-view-api.datx.vn
    use_backend backend_prod_trading_view_api 	if prod_trading_view_api
    use_backend backend_prod_trading_view_api 	if prod_trading_view_api_datxvn

    # beta

    # beta domain datxasia
    acl beta_trading_view_api hdr(host)             -i beta-trading-view-api.datxstg.com
    acl beta_trading_view_api_datxasia hdr(host)    -i beta-tradingview-api.datxasia.com

    use_backend backend_beta_trading_view_api       if beta_trading_view_api
    use_backend backend_beta_trading_view_api       if beta_trading_view_api_datxasia

    ### ====================
    ### xwealth

    # beta
    acl beta_xwealth_platform_v1 hdr(host) -i beta-xwealth-platform-v1.datxstg.com
    use_backend backend_beta_xwealth_platform_v1 	if beta_xwealth_platform_v1

    acl beta_xwealth_platform_v1_datxasia hdr(host) -i beta-xwealth.datxasia.com
    use_backend backend_beta_xwealth_platform_v1 	if beta_xwealth_platform_v1_datxasia

    # copytrade beta
    acl copytrade_beta_xwealth_platform_v1 hdr(host) -i copytrade-beta-xwealth-platform-v1.datxstg.com
    use_backend backend_copytrade_beta_xwealth_platform_v1 	if copytrade_beta_xwealth_platform_v1
    
    acl copytrade_beta_xwealth_platform_v1_datxasia hdr(host) -i uat-copytrade.datxasia.com
    use_backend backend_copytrade_beta_xwealth_platform_v1 	if copytrade_beta_xwealth_platform_v1_datxasia

    # copytrade 
    acl copytrade_xwealth_platform_v1 hdr(host) -i copytrade-xwealth-platform-v1.datxstg.com
    use_backend backend_copytrade_xwealth_platform_v1 	if copytrade_xwealth_platform_v1

    acl portfolio_datx_vn hdr(host) -i portfolio.datx.vn
    use_backend backend_copytrade_xwealth_platform_v1 	if portfolio_datx_vn

    acl copytrade_xwealth_platform_v1_datxvn hdr(host) -i copytrade.datx.vn
    use_backend backend_copytrade_xwealth_platform_v1 	if copytrade_xwealth_platform_v1_datxvn

    # beta vix
    acl vix_beta_xwealth_platform_v1 hdr(host) -i vix-beta-xwealth.datxstg.com
    use_backend backend_vix_beta_xwealth_platform_v1 	if vix_beta_xwealth_platform_v1

    acl vix_beta_xwealth_platform_v1_datxasia hdr(host) -i vix-beta-xwealth.datxasia.com
    use_backend backend_vix_beta_xwealth_platform_v1 	if vix_beta_xwealth_platform_v1_datxasia

    # beta psi 
    acl psi_beta_xwealth_platform_v1 hdr(host) -i psi-beta-xwealth.datxstg.com
    use_backend backend_psi_beta_xwealth_platform_v1 	if psi_beta_xwealth_platform_v1

    acl psi_beta_xwealth_platform_v1_datxasia hdr(host) -i psi-beta-xwealth.datxasia.com
    use_backend backend_psi_beta_xwealth_platform_v1 	if psi_beta_xwealth_platform_v1_datxasia

    # beta bsc 
    acl bsc_beta_xwealth_platform_v1 hdr(host)          -i bsc-beta-xwealth.datxstg.com
    use_backend backend_bsc_beta_xwealth_platform_v1 	if bsc_beta_xwealth_platform_v1

    # main bsc 
    acl bsc_main_xwealth_platform_v1 hdr(host)          -i bsc-xwealth.datx.vn
    use_backend backend_bsc_main_xwealth_platform_v1 	if bsc_main_xwealth_platform_v1

    # beta f247
    acl f247_beta_xwealth_platform_v1 hdr(host) -i f247-beta-xwealth.datxstg.com
    use_backend backend_f247_beta_xwealth_platform_v1 	if f247_beta_xwealth_platform_v1

    acl f247_beta_xwealth_platform_v1_datxasia hdr(host) -i f247-beta-xwealth.datxasia.com
    use_backend backend_f247_beta_xwealth_platform_v1 	if f247_beta_xwealth_platform_v1_datxasia

    # beta bvote
    acl bvote_beta_xwealth_platform_v1 hdr(host) -i bvote-beta-xwealth.datxstg.com
    use_backend backend_bvote_beta_xwealth_platform_v1 	if bvote_beta_xwealth_platform_v1

    # Beta order
    
    # acl host_beta-order_datxasia_com                hdr(host)                                       -i  beta-order.datxasia.com
    # use_backend                                     backend_beta-order_datxasia_com                 if  host_beta-order_datxasia_com whitelist

    # acl host_vix-beta-order_datxasia_com            hdr(host)                                       -i  vix-beta-order.datxasia.com
    # use_backend                                     backend_beta-order_datxasia_com                 if  host_vix-beta-order_datxasia_com whitelist

    # acl host_f247-beta-order_datxasia_com           hdr(host)                                       -i  f247-beta-order.datxasia.com
    # use_backend                                     backend_beta-order_datxasia_com                 if  host_f247-beta-order_datxasia_com whitelist

    acl beta_order_website_whitelist                  hdr(host)                           -i  beta-order-whitelist.datxasia.com
    use_backend                             backend_beta_order_website               if  beta_order_website_whitelist whitelist
    
    acl beta_order_website                  hdr(host)                           -i  beta-order.datxasia.com
    use_backend                             backend_beta_order_website               if  beta_order_website # whitelist


    acl beta_order_website_vix                 hdr(host)                       -i vix-beta-order.datxasia.com
    use_backend                         backend_beta_order_website         if beta_order_website_vix # whitelist

    acl beta_order_website_f247                 hdr(host)                       -i f247-beta-order.datxasia.com
    use_backend                         backend_beta_order_website         if beta_order_website_f247 # whitelist

    acl beta_order_website_vps                 hdr(host)                       -i vps-beta-order.datxasia.com
    use_backend                         backend_beta_order_website         if beta_order_website_vps # whitelist

    #Beta sale api
    acl host_beta-sale-api-v1_datxasia_com          hdr(host)                                       -i  beta-sale-api-v1.datxasia.com
    use_backend                                     backend_beta-sale-api-v1_datxasia_com           if  host_beta-sale-api-v1_datxasia_com
    acl beta_payment_vnpay                          path_beg                                        /api/v1/payment/link/vnpay
    http-request deny                               if                                              host_beta-sale-api-v1_datxasia_com beta_payment_vnpay !whitelist

    #Beta payment gateway
    acl beta_payment_gateway                hdr(host)                                   -i beta-payment.datxasia.com
    use_backend                             backend_beta_payment_gateway               if  beta_payment_gateway #whitelist

    ############

    #Developer Portal
    acl host_main-hook-api                  hdr(host)                           -i  hook-api.datx.vn
    use_backend                             backend_main-hook-api               if  host_main-hook-api

    acl host_main-developer-portal          hdr(host)                           -i  developer-portal.datx.vn
    use_backend                             backend_main-developer-portal       if  host_main-developer-portal 
    
    
    
    # production
    acl prod_xwealth_platform_v1 hdr(host) -i main-xwealth-platform-v1.datxstg.com
    use_backend backend_prod_xwealth_platform_v1 	if prod_xwealth_platform_v1

    acl prod_xwealth_platform_v1_datxvn hdr(host) -i xwealth.datx.vn
    use_backend backend_prod_xwealth_platform_v1 	if prod_xwealth_platform_v1_datxvn

    # production vix
    acl prod_vix_xwealth_platform_v1 hdr(host) -i vix-xwealth-platform-v1.datxstg.com
    use_backend backend_vix_xwealth_platform_v1 	if prod_vix_xwealth_platform_v1

    # production f247
    acl prod_f247_xwealth_platform_v1 hdr(host) -i f247-xwealth-platform-v1.datxstg.com
    use_backend backend_f247_xwealth_platform_v1 	if prod_vix_xwealth_platform_v1

    acl prod_f247_xwealth_platform_v1_f247 hdr(host) -i xwealth.f247.com
    use_backend backend_f247_xwealth_platform_v1 	if prod_f247_xwealth_platform_v1_f247

    # production bvote
    
    acl bvote_main_xwealth_platform_v1 hdr(host) -i bvote-main-xwealth.datxstg.com
    use_backend backend_bvote_main_xwealth_platform_v1 	if bvote_main_xwealth_platform_v1

    acl bvote_main_xwealth_platform_v1_bvote hdr(host) -i xwealth.bvote.vn
    use_backend backend_bvote_main_xwealth_platform_v1 	if bvote_main_xwealth_platform_v1_bvote
 
    acl prod_vix_xwealth_platform_v1_vixs hdr(host) -i xwealth.vixs.vn
    use_backend backend_vix_xwealth_platform_v1 	if prod_vix_xwealth_platform_v1_vixs

    # production psi
    acl prod_psi_xwealth_platform_v1 hdr(host) -i psi-xwealth-platform-v1.datxstg.com
    use_backend backend_psi_xwealth_platform_v1 	if prod_psi_xwealth_platform_v1
    
    acl prod_psi_xwealth_platform_v1_psi hdr(host) -i ps-ai.psi.vn
    use_backend backend_psi_xwealth_platform_v1 	if prod_psi_xwealth_platform_v1_psi

    # production f247
    acl prod_f247_xwealth_platform_v1 hdr(host) -i f247-xwealth-platform-v1.datxstg.com
    use_backend backend_f247_xwealth_platform_v1 	if prod_f247_xwealth_platform_v1

    ### ====================
    ### order
    ### ====================
    
    # prod order

    acl prod_order_website hdr(host) -i main-order-website.datxstg.com
    use_backend backend_main_order_website 	if prod_order_website

    acl prod_order_website_datxvn hdr(host) -i order.datx.vn
    use_backend backend_main_order_website 	if prod_order_website_datxvn

    acl prod_order_website_vixs hdr(host) -i order.xwealth.vixs.vn
    use_backend backend_main_order_website 	if prod_order_website_vixs

    acl prod_order_website_f247 hdr(host) -i order.xwealth.f247.com
    use_backend backend_main_order_website 	if prod_order_website_f247

    acl prod_order_website_bvote hdr(host) -i order.xwealth.bvote.vn
    use_backend backend_main_order_website 	if prod_order_website_bvote

    ### ====================
    ### copytrade backend
    
    acl beta_copytrade_backend                   hdr(host)                               -i beta-copytrade-backend.datxstg.com
    use_backend                                     backend_beta_copytrade_backend       if beta_copytrade_backend

    acl prod_copytrade_backend                   hdr(host)                               -i prod-copytrade-backend.datxstg.com
    use_backend                                     backend_prod_copytrade_backend       if prod_copytrade_backend

    ### ====================
    ### core v2

    acl beta_datx_dashboard_api_v2                   hdr(host)                               -i beta-api-v2.datxstg.com
    use_backend                                     backend_beta_datx_dashboard_api_v2       if beta_datx_dashboard_api_v2

    acl beta_datx_dashboard_api_v2_asia                   hdr(host)                               -i beta-api-v2.datxasia.com
    use_backend                                     backend_beta_datx_dashboard_api_v2       if beta_datx_dashboard_api_v2_asia

    acl main_datx_dashboard_api_v2                   hdr(host)                               -i main-api-v2.datxstg.com
    use_backend                                     backend_main_datx_dashboard_api_v2       if main_datx_dashboard_api_v2

    acl main_datx_dashboard_api_v2_datxvn                   hdr(host)                               -i portfolio-api-v2.datx.vn
    use_backend                                     backend_main_datx_dashboard_api_v2       if main_datx_dashboard_api_v2_datxvn

    ### ====================
    ### core v3

    # beta
    acl beta_datx_core_v3                   hdr(host)                               -i beta-datx-core-v3.datxstg.com
    use_backend                                     backend_beta_datx_core_v3       if beta_datx_core_v3

    acl beta_datx_core_v3_app_worker                   hdr(host)                               -i beta-datx-core-v3-app-worker.datxstg.com
    use_backend                                     backend_beta_datx_core_v3_app_worker       if beta_datx_core_v3_app_worker

    acl beta_datx_core_v3_datxasia                  hdr(host)                               -i beta-core.datxasia.com
    use_backend                                     backend_beta_datx_core_v3       if beta_datx_core_v3_datxasia

    # main
    acl main_datx_core_v3                   hdr(host)                               -i main-datx-core-v3.datxstg.com
    use_backend                                     backend_main_datx_core_v3       if main_datx_core_v3

    acl main_datx_core_v3_app_worker                   hdr(host)                               -i main-datx-core-v3-app-worker.datxstg.com
    use_backend                                     backend_main_datx_core_v3_app_worker       if main_datx_core_v3_app_worker

    acl main_datx_core_v3_datxvn                  hdr(host)                               -i core.datx.vn
    use_backend                                     backend_main_datx_core_v3       if main_datx_core_v3_datxvn

    ### ====================
    ### core notification service

    #Beta node-core-notification-service
    acl beta_node_core_notification_service                hdr(host)                                   -i beta-node-core-notification-service.datxasia.com
    use_backend                             backend_beta_node_core_notification_service               if  beta_node_core_notification_service #whitelist

    # main
    acl main_node_core_notification_service                hdr(host)                                   -i node-core-notification-service.datx.vn
    use_backend                             backend_node_core_notification_service               if  main_node_core_notification_service #whitelist

    ### ====================
    ### middleware / webapp-api
    
    # beta

    acl beta_webapp_api                  hdr(host)                       -i beta-api.datxstg.com
    use_backend                         backend_beta_datx_webapp_api          if beta_webapp_api

    acl beta_webapp_api_datxasia                  hdr(host)                       -i beta-api.datxasia.com
    use_backend                         backend_beta_datx_webapp_api          if beta_webapp_api_datxasia
    
    # main

    acl main_webapp_api                  hdr(host)                       -i main-api.datxstg.com
    use_backend                         backend_main_webapp_api          if main_webapp_api

    acl main_webapp_api_datxvn                  hdr(host)                       -i api.datx.vn
    use_backend                         backend_main_webapp_api          if main_webapp_api_datxvn

    ### ====================
    ### datx sale portal api
    ### ====================

    # beta
    acl beta_datx_sale_portal_api hdr(host) -i beta-datx-sale-portal-api.datxstg.com
    use_backend backend_beta_datx_sale_portal_api if beta_datx_sale_portal_api

    acl beta_datx_sale_portal_api_datxasia hdr(host) -i beta-sale-api-v1.datxasia.com
    use_backend backend_beta_datx_sale_portal_api if beta_datx_sale_portal_api_datxasia

    # main
    acl main_datx_sale_portal_api hdr(host) -i main-datx-sale-portal-api.datxstg.com
    use_backend backend_main_datx_sale_portal_api if main_datx_sale_portal_api

    acl main_datx_sale_portal_api_datxvn hdr(host) -i sales-api.datx.vn
    use_backend backend_main_datx_sale_portal_api if main_datx_sale_portal_api_datxvn

    ### ====================
    ### datx sale portal
    ### ====================

    # beta
    acl beta_datx_sale_portal hdr(host) -i beta-datx-sale-portal.datxstg.com
    use_backend backend_beta_datx_sale_portal if beta_datx_sale_portal

    acl beta_datx_sale_portal_datxasia hdr(host) -i beta-sale.datxasia.com
    use_backend backend_beta_datx_sale_portal if beta_datx_sale_portal_datxasia

    # main
    acl main_datx_sale_portal hdr(host) -i main-datx-sale-portal.datxstg.com
    use_backend backend_main_datx_sale_portal if main_datx_sale_portal

    acl main_datx_sale_portal_datxvn hdr(host) -i sales.datx.vn
    use_backend backend_main_datx_sale_portal if main_datx_sale_portal_datxvn

    

    ### ====================
    ### rating-widget
    ### ====================

    # beta
    acl beta_rating_widget hdr(host) -i beta-rating-widget.datxstg.com
    use_backend backend_beta_rating_widget if beta_rating_widget

    acl beta_rating_widget_datxasia hdr(host) -i beta-widget.datxasia.com
    use_backend backend_beta_rating_widget if beta_rating_widget_datxasia

    # main
    acl main_rating_widget hdr(host) -i main-rating-widget.datxstg.com
    use_backend backend_main_rating_widget if main_rating_widget

    acl main_rating_widget_datxvn hdr(host) -i widget.datx.vn
    use_backend backend_main_rating_widget if main_rating_widget_datxvn

    ### ====================
    ### stock-account-manager
    ### ====================

    # beta
    acl beta_stock_account_manager hdr(host) -i beta-stock-account-manager.datxstg.com
    use_backend backend_beta_stock_account_manager if beta_stock_account_manager

    # prod
    acl main_stock_account_manager hdr(host) -i main-stock-account-manager.datxstg.com
    use_backend backend_main_stock_account_manager if main_stock_account_manager

    ### ====================
    ### ai-broker
    ### ====================

    # beta
    acl beta_ai_broker hdr(host) -i beta-ai-broker.datxstg.com
    use_backend backend_beta_ai_broker if beta_ai_broker

    acl beta_ai_broker_datxasia hdr(host) -i beta-aibroker.datxasia.com
    use_backend backend_beta_ai_broker if beta_ai_broker_datxasia

    # main
    acl main_ai_broker hdr(host) -i main-ai-broker.datxstg.com
    use_backend backend_main_ai_broker if main_ai_broker

    acl main_ai_broker_datxvn hdr(host) -i aibroker.datx.vn
    use_backend backend_main_ai_broker if main_ai_broker_datxvn

    ### ====================
    ### authentication
    ### ====================

    # beta
    acl beta_authentication hdr(host) -i beta-authentication.datxstg.com
    use_backend backend_beta_authentication if beta_authentication

    acl beta_authentication_datxasia hdr(host) -i beta-auth.datxasia.com
    use_backend backend_beta_authentication if beta_authentication_datxasia

    # main
    
    acl main_authentication hdr(host) -i main-authentication.datxstg.com
    use_backend backend_main_authentication if main_authentication

    acl main_authentication_datxvn hdr(host) -i auth.datx.vn
    use_backend backend_main_authentication if main_authentication_datxvn


    ### ====================
    ### CMS Frontend
    ### ====================

    # beta
    acl beta_cms_2_frontend hdr(host) -i beta-cms-2-frontend.datxstg.com
    use_backend backend_beta_cms_2_frontend if beta_cms_2_frontend

    acl beta_cms_2_frontend_datxasia hdr(host) -i beta-cms-v2.datxasia.com
    use_backend backend_beta_cms_2_frontend if beta_cms_2_frontend_datxasia
    
    acl main_cms_2_frontend hdr(host) -i main-cms-2-frontend.datxstg.com
    use_backend backend_main_cms_2_frontend if main_cms_2_frontend

    acl main_cms_2_frontend_datxvn hdr(host) -i cms.datx.vn
    use_backend backend_main_cms_2_frontend if main_cms_2_frontend_datxvn

    acl main_cms_2_frontend_datx hdr(host) -i datx.vn
    acl www_datx_vn hdr(host) -i www.datx.vn

    # main mobile document 

    acl main_mobile_document    hdr(host)                                       -i mobile-document.datx.vn
    use_backend                                     backend_main_mobile_document         if main_mobile_document
    

    # acl main_cms_2_frontend_datx_com_vn hdr(host) -i datx.com.vn
    # acl www_datx_com_vn hdr(host) -i www.datx.com.vn
    
    use_backend backend_main_cms_2_frontend if main_cms_2_frontend_datx
    use_backend backend_main_cms_2_frontend if www_datx_vn

    use_backend backend_main_cms_2_frontend if www_datx_com_vn
    use_backend backend_main_cms_2_frontend if datx_com_vn

    # use_backend backend_main_cms_2_frontend if main_cms_2_frontend_datx_com_vn
    # use_backend backend_main_cms_2_frontend if www_datx_com_vn
    ### ====================
    ### CMS API
    ### ====================

    # beta
    acl beta_datx_cms_v2 hdr(host) -i beta-datx-cms-v2.datxstg.com
    use_backend backend_beta_datx_cms_v2 if beta_datx_cms_v2


    acl beta_datx_cms_v2_datxasia hdr(host) -i beta-cms-v2-api.datxasia.com
    use_backend backend_beta_datx_cms_v2 if beta_datx_cms_v2_datxasia
    
    acl main_datx_cms_v2 hdr(host) -i main-datx-cms-v2.datxstg.com
    use_backend backend_main_datx_cms_v2 if main_datx_cms_v2

    acl main_datx_cms_v2_datxvn hdr(host) -i cms-api-v2.datx.vn
    use_backend backend_main_datx_cms_v2 if main_datx_cms_v2_datxvn

    ### ====================
    ### Datx Insight
    ### ====================

    # beta
    acl beta_datx_insight_v2 hdr(host) -i beta-datx-insight-v2.datxstg.com
    use_backend backend_beta_datx_insight_v2 if beta_datx_insight_v2

    acl beta_datx_insight_v2_datxasia hdr(host) -i beta-insight.datxasia.com
    use_backend backend_beta_datx_insight_v2 if beta_datx_insight_v2_datxasia

    # main

    acl main_datx_insight_v2 hdr(host) -i main-datx-insight-v2.datxstg.com
    use_backend backend_main_datx_insight_v2 if main_datx_insight_v2

    acl main_datx_insight_v2_datxvn hdr(host) -i insight.datx.vn
    use_backend backend_main_datx_insight_v2 if main_datx_insight_v2_datxvn

    ### ====================
    ### market-price-api
    ### ====================

    # beta
    
    acl beta_market_price_api hdr(host) -i beta-market-price-api.datxstg.com
    use_backend backend_beta_market_price_api if beta_market_price_api

    acl beta_market_price_api_datxasia hdr(host) -i beta-socket.datxasia.com
    use_backend backend_beta_market_price_api if beta_market_price_api_datxasia

    # main

    acl main_market_price_api hdr(host) -i main-market-price-api.datxstg.com
    use_backend backend_main_market_price_api if main_market_price_api

    acl main_market_price_api_datxvn hdr(host) -i socket.datx.vn
    use_backend backend_main_market_price_api if main_market_price_api_datxvn

    # crm
    acl crm_datxstg_com hdr(host) -i crm.datxstg.com
    use_backend backend_crm_datxstg_com if crm_datxstg_com

    acl crm_api_datxstg_com hdr(host) -i crm-api.datxstg.com
    use_backend backend_crm_api_datxstg_com if crm_api_datxstg_com

    acl crm_v2_api_datxstg_com hdr(host) -i crm-v2.datxstg.com
    use_backend backend_crm_v2_api_datxstg_com if crm_v2_api_datxstg_com
    
    
    
    # payment gateway
    acl main_payment_gateway                hdr(host)                             -i payment-gateway-api.datx.vn
    use_backend                             backend_payment_gateway               if  main_payment_gateway #whitelist

    # minio console
    acl prod_tpc_minio_console hdr(host)       -i minio.datxasia.com
    use_backend backend_prod_tpc_minio_console    if prod_tpc_minio_console #whitelist

    # main-iframe-website
    acl main-iframe-website                 hdr(host)                             -i trading-uat.bsc.com.vn
    use_backend                             backend_prod_ingress_nginx_http       if main-iframe-website #whitelist

    ### ====================
    ### k8s service
    #datx.vn
    acl prod_osticket hdr(host)         -i supports.datx.vn
    acl prod_game hdr(host)             -i game.datx.vn
    acl prod_uptime hdr(host)           -i uptime.datx.vn
    acl prod_uptime-hn1 hdr(host)       -i uptime-hn1.datx.vn
    acl prod_mkt hdr(host)              -i mkt.datx.vn
    acl prod_crm hdr(host)              -i crm.datx.vn
    acl prod_argocd hdr(host)           -i argocd.datx.vn
    acl prod_longhorn hdr(host)         -i longhorn.datx.vn
    acl prod_alertmanager hdr(host)     -i alertmanager.datx.vn
    acl prod_prometheus hdr(host)       -i prometheus.datx.vn
    acl prod_monitor hdr(host)          -i monitor.datx.vn
    acl prod_pmm hdr(host)              -i pmm.datx.vn
    acl prod_harbor hdr(host)           -i harbor.datx.vn
    acl prod_support hdr(host)          -i support.datx.vn
    acl prod_kibana hdr(host)           -i kibana.datx.vn
    acl prod_jenkins-ci hdr(host)       -i jenkins-ci.datx.vn
    acl prod_certbot hdr(host)          -i certbot.datxasia.com

    #datxasia.com 
    acl prod_rancher hdr(host)          -i rancher.datxasia.com
    acl prod_passbolt hdr(host)         -i passbolt.datxasia.com
    acl prod_luckydraw hdr(host)        -i luckydraw.datxasia.com

    use_backend backend_prod_uptime         if prod_uptime
    use_backend backend_prod_uptime-hn1     if prod_uptime-hn1
    use_backend backend_prod_argocd         if prod_argocd
    use_backend backend_prod_longhorn       if prod_longhorn
    use_backend backend_prod_alertmanager   if prod_alertmanager
    use_backend backend_prod_prometheus     if prod_prometheus
    use_backend backend_prod_monitor        if prod_monitor
    use_backend backend_prod_pmm            if prod_pmm
    use_backend backend_prod_harbor         if prod_harbor
    use_backend backend_prod_osticket       if prod_support
    use_backend backend_prod_kibana         if prod_kibana
    use_backend backend_prod_jenkins-ci        if prod_jenkins-ci
    use_backend backend_prod_mkt            if prod_mkt
    use_backend backend_prod_crm            if prod_crm
    use_backend backend_prod_certbot        if prod_certbot

    use_backend backend_rancher             if prod_rancher
    use_backend backend_prod_passbolt       if prod_passbolt
    use_backend backend_prod_luckydraw      if prod_luckydraw
    use_backend backend_prod_luckydraw      if prod_game

    acl rabbitmq_management_prod                 hdr(host)   -i rabbitmq-management-prod.datxstg.com
    use_backend     backend_rabbitmq_management_prod             if rabbitmq_management_prod

    acl rabbitmq_management_beta                 hdr(host)   -i rabbitmq-management-beta.datxstg.com
    use_backend     backend_rabbitmq_management_beta             if rabbitmq_management_beta

    # kafka connect 
    acl host_kafka_ui hdr(host) -i kafka-ui-prod.datxstg.com
    use_backend backend_kafka_ui if host_kafka_ui

    # acl host_schema_registry hdr(host) -i schema-registry-prod.datxstg.com
    # use_backend backend_schema_registry if host_schema_registry

    # Kafka UI Readonly
    acl host_kafka-ui-sdc.datxasia.com hdr(host) -i kafka-ui-sdc.datxasia.com
    use_backend backend_kafka-ui-sdc.datxasia.com if host_kafka-ui-sdc.datxasia.com

# K8S Service

backend backend_prod_luckydraw
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31179 check
    server k8s-prod01-worker02 10.48.14.22:31179 check
    server k8s-prod01-worker03 10.48.14.23:31179 check
    server k8s-prod01-worker04 10.48.14.24:31179 check

backend backend_main-hook-api
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31171 check
    server k8s-prod01-worker02 10.48.14.22:31171 check
    server k8s-prod01-worker03 10.48.14.23:31171 check
    server k8s-prod01-worker04 10.48.14.24:31171 check
  

backend backend_main-developer-portal
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31172 check
    server k8s-prod01-worker02 10.48.14.22:31172 check
    server k8s-prod01-worker03 10.48.14.23:31172 check
    server k8s-prod01-worker04 10.48.14.24:31172 check


backend backend_rabbitmq_management_prod
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:32024 check
    server k8s-prod01-worker02 10.48.14.22:32024 check
    server k8s-prod01-worker03 10.48.14.23:32024 check
    server k8s-prod01-worker04 10.48.14.24:32024 check

backend backend_rabbitmq_management_beta
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:32034 check
    server k8s-prod01-worker02 10.48.14.22:32034 check
    server k8s-prod01-worker03 10.48.14.23:32034 check
    server k8s-prod01-worker04 10.48.14.24:32034 check

backend backend_prod_argocd
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:32003 check
    server k8s-prod01-worker02 10.48.14.22:32003 check
    server k8s-prod01-worker03 10.48.14.23:32003 check
    server k8s-prod01-worker04 10.48.14.24:32003 check

backend backend_prod_monitor
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:32008 check
    server k8s-prod01-worker02 10.48.14.22:32008 check
    server k8s-prod01-worker03 10.48.14.23:32008 check
    server k8s-prod01-worker04 10.48.14.24:32008 check

backend backend_prod_pmm
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:32110 ssl verify none
    server k8s-prod01-worker02 10.48.14.22:32110 ssl verify none
    server k8s-prod01-worker03 10.48.14.23:32110 ssl verify none
    server k8s-prod01-worker04 10.48.14.24:32110 ssl verify none

backend backend_prod_certbot
    mode http
    balance roundrobin
    option httpchk GET /
    server datx-ansible01 10.0.255.10:80 check

backend backend_prod_osticket
    timeout server  3600s
    mode http
    option httpchk GET /
    server osticket01 10.0.255.11:443 check weight 1 maxconn 1024 ssl verify none

# backend backend_prod_osticket
#     timeout server  3600s
#     mode http
#     option httpchk GET /
#     server osticket01 10.48.16.30:443 check weight 1 maxconn 1024 ssl verify none

backend backend_prod_kibana
    mode http
    balance roundrobin
    option httpchk GET /
    server datx-elasticsearch-prod-01 192.168.0.90:5601 check

backend backend_prod_uptime
    mode http
    balance roundrobin
    option httpchk GET /
    server datx-ansible01 10.0.255.10:3001 check

backend backend_prod_uptime-hn1
    mode http
    balance roundrobin
    option httpchk GET /
    server datx-backup01 192.168.0.110:3001 check

backend backend_prod_passbolt
    mode http
    balance roundrobin
    option httpchk GET /
    server datx-ansible01 10.0.255.10:8088 check

backend backend_prod_jenkins-ci
    server datx-jenkins-ci01 10.0.255.50:8080 check

backend backend_prod_mkt
    server osticket01 10.0.129.30:443 check weight 1 maxconn 1024 ssl verify none

backend backend_rancher
    server datx-ansible01 10.0.255.10:8443 check weight 1 maxconn 1024 ssl verify none

backend backend_prod_crm
    server datx-crm-prod-01 10.0.129.31:443 check weight 1 maxconn 1024 ssl verify none

backend backend_prod_harbor
    server harbor01 10.0.255.14:443 ssl verify none

backend backend_crm_datxstg_com
    mode http
    option httpchk GET /
    server datx-crm-prod-01 10.0.129.31:8081 check weight 1 maxconn 1024

backend backend_crm_api_datxstg_com
    timeout server  3600s
    mode http
    option httpchk GET /
    server datx-crm-prod-01 10.0.129.31:3000 check weight 1 maxconn 1024

backend backend_crm_v2_api_datxstg_com
    timeout server  3600s
    mode http
    option httpchk GET /
    server datx-crm-prod-01 10.0.129.31:3001 check weight 1 maxconn 1024

backend backend_payment_gateway
    mode http
    balance roundrobin
    option httpchk GET /health-check
    server k8s-prod01-worker01 10.48.14.21:31087 check
    server k8s-prod01-worker02 10.48.14.22:31087 check
    server k8s-prod01-worker03 10.48.14.23:31087 check
    server k8s-prod01-worker04 10.48.14.24:31087 check

backend backend_prod_tpc_minio_console
    mode http
    balance roundrobin
    option httpchk GET /
    server tpc-minio-infra-prod-01 10.48.9.20:9000 check
    server tpc-minio-infra-prod-02 10.48.9.21:9000 check

backend backend_prod_alertmanager
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:32006 check
    server k8s-prod01-worker02 10.48.14.22:32006 check
    server k8s-prod01-worker03 10.48.14.23:32006 check
    server k8s-prod01-worker04 10.48.14.24:32006 check

backend backend_prod_prometheus
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:32009 check
    server k8s-prod01-worker02 10.48.14.22:32009 check
    server k8s-prod01-worker03 10.48.14.23:32009 check
    server k8s-prod01-worker04 10.48.14.24:32009 check

backend backend_prod_longhorn
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:32001 check
    server k8s-prod01-worker02 10.48.14.22:32001 check
    server k8s-prod01-worker03 10.48.14.23:32001 check
    server k8s-prod01-worker04 10.48.14.24:32001 check

# Beta

# backend backend_beta-order_datxasia_com
#     mode http
#     server datx-stg01 192.168.12.31:443 ssl verify none

backend backend_beta-sale-api-v1_datxasia_com
    mode http
    balance roundrobin
    option httpchk GET /api/v1/health
    server k8s-prod01-worker01 10.48.14.21:31011 check
    server k8s-prod01-worker02 10.48.14.22:31011 check
    server k8s-prod01-worker03 10.48.14.23:31011 check
    server k8s-prod01-worker04 10.48.14.24:31011 check
    
backend backend_beta_tradingview
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31001 check
    server k8s-prod01-worker02 10.48.14.22:31001 check
    server k8s-prod01-worker03 10.48.14.23:31001 check
    server k8s-prod01-worker04 10.48.14.24:31001 check

backend backend_beta_charts
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31002 check
    server k8s-prod01-worker02 10.48.14.22:31002 check
    server k8s-prod01-worker03 10.48.14.23:31002 check
    server k8s-prod01-worker04 10.48.14.24:31002 check

backend backend_beta_trading_view_api
    mode http
    balance roundrobin
    option httpchk GET /health
    server k8s-prod01-worker01 10.48.14.21:31003 check
    server k8s-prod01-worker02 10.48.14.22:31003 check
    server k8s-prod01-worker03 10.48.14.23:31003 check
    server k8s-prod01-worker04 10.48.14.24:31003 check

backend backend_beta_xwealth_platform_v1
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31004 check
    server k8s-prod01-worker02 10.48.14.22:31004 check
    server k8s-prod01-worker03 10.48.14.23:31004 check
    server k8s-prod01-worker04 10.48.14.24:31004 check

backend backend_beta_copytrade_backend
    mode http
    balance roundrobin
    option httpchk GET /api/health-check
    server k8s-prod01-worker01 10.48.14.21:31005 check
    server k8s-prod01-worker02 10.48.14.22:31005 check
    server k8s-prod01-worker03 10.48.14.23:31005 check
    server k8s-prod01-worker04 10.48.14.24:31005 check

backend backend_prod_copytrade_backend
    mode http
    balance roundrobin
    option httpchk GET /api/health-check
    server k8s-prod01-worker01 10.48.14.21:31105 check
    server k8s-prod01-worker02 10.48.14.22:31105 check
    server k8s-prod01-worker03 10.48.14.23:31105 check

backend backend_beta_datx_dashboard_api_v2
    mode http
    balance roundrobin
    option httpchk GET /hsx/health
    server k8s-prod01-worker01 10.48.14.21:31007 check
    server k8s-prod01-worker02 10.48.14.22:31007 check
    server k8s-prod01-worker03 10.48.14.23:31007 check
    server k8s-prod01-worker04 10.48.14.24:31007 check


backend backend_beta_datx_sale_portal_api
    mode http
    balance roundrobin
    option httpchk GET /api/v1/health
    server k8s-prod01-worker01 10.48.14.21:31011 check
    server k8s-prod01-worker02 10.48.14.22:31011 check
    server k8s-prod01-worker03 10.48.14.23:31011 check
    server k8s-prod01-worker04 10.48.14.24:31011 check

backend backend_beta_datx_sale_portal
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31012 check
    server k8s-prod01-worker02 10.48.14.22:31012 check
    server k8s-prod01-worker03 10.48.14.23:31012 check
    server k8s-prod01-worker04 10.48.14.24:31012 check

backend backend_beta_payment_gateway
    mode http
    balance roundrobin
    option httpchk GET /health-check
    server k8s-prod01-worker01 10.48.14.21:31076 check
    server k8s-prod01-worker02 10.48.14.22:31076 check
    server k8s-prod01-worker03 10.48.14.23:31076 check
    server k8s-prod01-worker04 10.48.14.24:31076 check

backend backend_beta_node_core_notification_service
    mode http
    balance roundrobin
    option httpchk GET /api/health-check
    server k8s-prod01-worker01 10.48.14.21:31014 check
    server k8s-prod01-worker02 10.48.14.22:31014 check
    server k8s-prod01-worker03 10.48.14.23:31014 check
    server k8s-prod01-worker04 10.48.14.24:31014 check

# Production

backend backend_prod_tradingview
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31101 check
    server k8s-prod01-worker02 10.48.14.22:31101 check
    server k8s-prod01-worker03 10.48.14.23:31101 check
    server k8s-prod01-worker04 10.48.14.24:31101 check

backend backend_sendgird_webhook
    mode http
    balance roundrobin
    option httpchk GET /health
    server k8s-prod01-worker01 10.48.14.21:31113 check
    server k8s-prod01-worker02 10.48.14.22:31113 check
    server k8s-prod01-worker03 10.48.14.23:31113 check
    server k8s-prod01-worker04 10.48.14.24:31113 check

backend backend_prod_charts
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31102 check
    server k8s-prod01-worker02 10.48.14.22:31102 check
    server k8s-prod01-worker03 10.48.14.23:31102 check
    server k8s-prod01-worker04 10.48.14.24:31102 check

backend backend_prod_trading_view_api
    mode http
    balance roundrobin
    option httpchk GET /health
    server k8s-prod01-worker01 10.48.14.21:31103 check
    server k8s-prod01-worker02 10.48.14.22:31103 check
    server k8s-prod01-worker03 10.48.14.23:31103 check
    server k8s-prod01-worker04 10.48.14.24:31103 check

backend backend_prod_xwealth_platform_v1
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31104 check
    server k8s-prod01-worker02 10.48.14.22:31104 check
    server k8s-prod01-worker03 10.48.14.23:31104 check
    server k8s-prod01-worker04 10.48.14.24:31104 check

backend backend_vix_xwealth_platform_v1
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31204 check
    server k8s-prod01-worker02 10.48.14.22:31204 check
    server k8s-prod01-worker03 10.48.14.23:31204 check
    server k8s-prod01-worker04 10.48.14.24:31204 check

backend backend_psi_xwealth_platform_v1
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31304 check
    server k8s-prod01-worker02 10.48.14.22:31304 check
    server k8s-prod01-worker03 10.48.14.23:31304 check
    server k8s-prod01-worker04 10.48.14.24:31304 check

backend backend_f247_xwealth_platform_v1
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31904 check
    server k8s-prod01-worker02 10.48.14.22:31904 check
    server k8s-prod01-worker03 10.48.14.23:31904 check
    server k8s-prod01-worker04 10.48.14.24:31904 check

backend backend_vix_beta_xwealth_platform_v1
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31804 check
    server k8s-prod01-worker02 10.48.14.22:31804 check
    server k8s-prod01-worker03 10.48.14.23:31804 check
    server k8s-prod01-worker04 10.48.14.24:31804 check

backend backend_psi_beta_xwealth_platform_v1
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31604 check
    server k8s-prod01-worker02 10.48.14.22:31604 check
    server k8s-prod01-worker03 10.48.14.23:31604 check
    server k8s-prod01-worker04 10.48.14.24:31604 check

backend backend_bsc_beta_xwealth_platform_v1
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31696 check
    server k8s-prod01-worker02 10.48.14.22:31696 check
    server k8s-prod01-worker03 10.48.14.23:31696 check
    server k8s-prod01-worker04 10.48.14.24:31696 check

backend backend_bsc_main_xwealth_platform_v1
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31298 check
    server k8s-prod01-worker02 10.48.14.22:31298 check
    server k8s-prod01-worker03 10.48.14.23:31298 check
    server k8s-prod01-worker04 10.48.14.24:31298 check

backend backend_f247_beta_xwealth_platform_v1
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31704 check
    server k8s-prod01-worker02 10.48.14.22:31704 check
    server k8s-prod01-worker03 10.48.14.23:31704 check
    server k8s-prod01-worker04 10.48.14.24:31704 check

backend backend_bvote_beta_xwealth_platform_v1
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31033 check
    server k8s-prod01-worker02 10.48.14.22:31033 check
    server k8s-prod01-worker03 10.48.14.23:31033 check
    server k8s-prod01-worker04 10.48.14.24:31033 check

backend backend_bvote_main_xwealth_platform_v1
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31034 check
    server k8s-prod01-worker02 10.48.14.22:31034 check
    server k8s-prod01-worker03 10.48.14.23:31034 check
    server k8s-prod01-worker04 10.48.14.24:31034 check

backend backend_copytrade_xwealth_platform_v1
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31404 check
    server k8s-prod01-worker02 10.48.14.22:31404 check
    server k8s-prod01-worker03 10.48.14.23:31404 check

backend backend_copytrade_beta_xwealth_platform_v1
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31504 check
    server k8s-prod01-worker02 10.48.14.22:31504 check
    server k8s-prod01-worker03 10.48.14.23:31504 check
    server k8s-prod01-worker04 10.48.14.24:31504 check

backend backend_main_datx_dashboard_api_v2
    mode http
    balance roundrobin
    option httpchk GET /hsx/health
    server k8s-prod01-worker01 10.48.14.21:31107 check
    server k8s-prod01-worker02 10.48.14.22:31107 check
    server k8s-prod01-worker03 10.48.14.23:31107 check
    server k8s-prod01-worker04 10.48.14.24:31107 check

backend backend_main_webapp_api
    mode http
    balance roundrobin
    option httpchk GET /api/health-check
    option http-server-close
    timeout server 600s
    timeout connect 600s
    timeout tunnel 600s
    http-request set-header Host %[req.hdr(Host)]
    http-request set-header X-Real-IP %[src]
    http-request set-header X-Forwarded-For %[src]
    http-request set-header X-Forwarded-Proto https
    http-request set-header app_version %[req.hdr(app_version)]
    server k8s-prod01-worker01 10.48.14.21:31108 check
    server k8s-prod01-worker02 10.48.14.22:31108 check
    server k8s-prod01-worker03 10.48.14.23:31108 check
    server k8s-prod01-worker04 10.48.14.24:31108 check

backend backend_main_datx_sale_portal_api
    mode http
    balance roundrobin
    option httpchk GET /api/v1/health
    server k8s-prod01-worker01 10.48.14.21:31111 check
    server k8s-prod01-worker02 10.48.14.22:31111 check
    server k8s-prod01-worker03 10.48.14.23:31111 check
    server k8s-prod01-worker04 10.48.14.24:31111 check

backend backend_main_datx_sale_portal
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31112 check
    server k8s-prod01-worker02 10.48.14.22:31112 check
    server k8s-prod01-worker03 10.48.14.23:31112 check
    server k8s-prod01-worker04 10.48.14.24:31112 check

backend backend_beta_stock_account_manager
    mode http
    balance roundrobin
    option httpchk GET /api/health-check
    server k8s-prod01-worker01 10.48.14.21:31030 check
    server k8s-prod01-worker02 10.48.14.22:31030 check
    server k8s-prod01-worker03 10.48.14.23:31030 check
    server k8s-prod01-worker04 10.48.14.24:31030 check

backend backend_main_stock_account_manager
    mode http
    balance roundrobin
    option httpchk GET /api/health-check
    server k8s-prod01-worker02 10.48.14.22:31031 check
    server k8s-prod01-worker01 10.48.14.21:31031 check
    server k8s-prod01-worker03 10.48.14.23:31031 check
    server k8s-prod01-worker04 10.48.14.24:31031 check

backend backend_beta_rating_widget
    mode http
    balance roundrobin
    option httpchk GET /health-check
    server k8s-prod01-worker01 10.48.14.21:31016 check
    server k8s-prod01-worker02 10.48.14.22:31016 check
    server k8s-prod01-worker03 10.48.14.23:31016 check
    server k8s-prod01-worker04 10.48.14.24:31016 check

backend backend_main_rating_widget
    mode http
    balance roundrobin
    option httpchk GET /health-check
    server k8s-prod01-worker01 10.48.14.21:31017 check
    server k8s-prod01-worker02 10.48.14.22:31017 check
    server k8s-prod01-worker03 10.48.14.23:31017 check
    server k8s-prod01-worker04 10.48.14.24:31017 check

backend backend_beta_ai_broker
    mode http
    balance roundrobin
    option httpchk GET /health-check
    server k8s-prod01-worker01 10.48.14.21:31006 check
    server k8s-prod01-worker02 10.48.14.22:31006 check
    server k8s-prod01-worker03 10.48.14.23:31006 check
    server k8s-prod01-worker04 10.48.14.24:31006 check

backend backend_main_ai_broker
    mode http
    balance roundrobin
    option httpchk GET /health-check
    server k8s-prod01-worker01 10.48.14.21:31009 check
    server k8s-prod01-worker02 10.48.14.22:31009 check
    server k8s-prod01-worker03 10.48.14.23:31009 check
    server k8s-prod01-worker04 10.48.14.24:31009 check

backend backend_main_order_website
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31106 check
    server k8s-prod01-worker02 10.48.14.22:31106 check
    server k8s-prod01-worker03 10.48.14.23:31106 check
    server k8s-prod01-worker04 10.48.14.24:31106 check

backend backend_beta_order_website
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31109 check
    server k8s-prod01-worker02 10.48.14.22:31109 check
    server k8s-prod01-worker03 10.48.14.23:31109 check
    server k8s-prod01-worker04 10.48.14.24:31109 check

backend backend_beta_datx_webapp_api
    mode http
    balance roundrobin
    option httpchk GET /api/health-check
    server k8s-prod01-worker01 10.48.14.21:31008 check
    server k8s-prod01-worker02 10.48.14.22:31008 check
    server k8s-prod01-worker03 10.48.14.23:31008 check
    server k8s-prod01-worker04 10.48.14.24:31008 check

backend backend_beta_datx_core_v3
    mode http
    balance roundrobin
    option httpchk GET /about/
    server k8s-prod01-worker01 10.48.14.21:31010 check
    server k8s-prod01-worker02 10.48.14.22:31010 check
    server k8s-prod01-worker03 10.48.14.23:31010 check
    server k8s-prod01-worker04 10.48.14.24:31010 check

backend backend_beta_datx_core_v3_app_worker
    mode http
    balance roundrobin
    option httpchk GET /healthz
    server k8s-prod01-worker01 10.48.14.21:31027 check
    server k8s-prod01-worker02 10.48.14.22:31027 check
    server k8s-prod01-worker03 10.48.14.23:31027 check
    server k8s-prod01-worker04 10.48.14.24:31027 check

backend backend_beta_authentication
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31018 check
    server k8s-prod01-worker02 10.48.14.22:31018 check
    server k8s-prod01-worker03 10.48.14.23:31018 check
    server k8s-prod01-worker04 10.48.14.24:31018 check

backend backend_main_authentication
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31024 check
    server k8s-prod01-worker02 10.48.14.22:31024 check
    server k8s-prod01-worker03 10.48.14.23:31024 check
    server k8s-prod01-worker04 10.48.14.24:31024 check

backend backend_beta_cms_2_frontend
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31019 check
    server k8s-prod01-worker02 10.48.14.22:31019 check
    server k8s-prod01-worker03 10.48.14.23:31019 check
    server k8s-prod01-worker04 10.48.14.24:31019 check

backend backend_beta_datx_cms_v2
    mode http
    balance roundrobin
    option httpchk GET /_health
    server k8s-prod01-worker01 10.48.14.21:31020 check
    server k8s-prod01-worker02 10.48.14.22:31020 check
    server k8s-prod01-worker03 10.48.14.23:31020 check
    server k8s-prod01-worker04 10.48.14.24:31020 check

backend backend_beta_datx_insight_v2
    mode http
    balance roundrobin
    option httpchk GET /health-check
    server k8s-prod01-worker01 10.48.14.21:31021 check
    server k8s-prod01-worker02 10.48.14.22:31021 check
    server k8s-prod01-worker03 10.48.14.23:31021 check
    server k8s-prod01-worker04 10.48.14.24:31021 check

backend backend_beta_market_price_api
    mode http
    balance roundrobin
    option httpchk GET /healthz
    option log-health-checks
    option http-server-close
    timeout tunnel 1h
    server k8s-prod01-worker01 10.48.14.21:31022 verify none
    server k8s-prod01-worker02 10.48.14.22:31022 verify none
    server k8s-prod01-worker03 10.48.14.23:31022 verify none
    server k8s-prod01-worker04 10.48.14.24:31022 verify none

backend backend_main_market_price_api
    # mode http
    # balance roundrobin
    # option httpchk GET /healthz
    option log-health-checks
    option http-server-close
    timeout tunnel 1h
    server k8s-prod01-worker01 10.48.14.21:31023 check
    server k8s-prod01-worker02 10.48.14.22:31023 check
    server k8s-prod01-worker03 10.48.14.23:31023 check
    server k8s-prod01-worker04 10.48.14.24:31023 check

backend backend_main_cms_2_frontend
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31025 check
    server k8s-prod01-worker02 10.48.14.22:31025 check
    server k8s-prod01-worker03 10.48.14.23:31025 check
    server k8s-prod01-worker04 10.48.14.24:31025 check

backend backend_main_mobile_document
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:31045 check
    server k8s-prod01-worker02 10.48.14.22:31045 check
    server k8s-prod01-worker03 10.48.14.23:31045 check
    server k8s-prod01-worker04 10.48.14.24:31045 check

backend backend_main_datx_cms_v2
    mode http
    balance roundrobin
    option httpchk GET /_health
    server k8s-prod01-worker01 10.48.14.21:31026 check
    server k8s-prod01-worker02 10.48.14.22:31026 check
    server k8s-prod01-worker03 10.48.14.23:31026 check
    server k8s-prod01-worker04 10.48.14.24:31026 check

backend backend_main_datx_insight_v2
    mode http
    balance roundrobin
    option httpchk GET /health-check
    server k8s-prod01-worker01 10.48.14.21:31028 check
    server k8s-prod01-worker02 10.48.14.22:31028 check
    server k8s-prod01-worker03 10.48.14.23:31028 check
    server k8s-prod01-worker04 10.48.14.24:31028 check

backend backend_main_datx_core_v3
    mode http
    balance roundrobin
    option httpchk GET /about/
    server k8s-prod01-worker01 10.48.14.21:31029 check
    server k8s-prod01-worker02 10.48.14.22:31029 check
    server k8s-prod01-worker03 10.48.14.23:31029 check
    server k8s-prod01-worker04 10.48.14.24:31029 check

backend backend_main_datx_core_v3_app_worker
    mode http
    balance roundrobin
    option httpchk GET /healthz
    server k8s-prod01-worker01 10.48.14.21:31032 check
    server k8s-prod01-worker02 10.48.14.22:31032 check
    server k8s-prod01-worker03 10.48.14.23:31032 check
    server k8s-prod01-worker04 10.48.14.24:31032 check

backend backend_kafka_ui
    mode http
    balance roundrobin
    option httpchk GET /
    server k8s-prod01-worker01 10.48.14.21:32004
    server k8s-prod01-worker02 10.48.14.22:32004
    server k8s-prod01-worker03 10.48.14.23:32004
    server k8s-prod01-worker04 10.48.14.24:32004

backend backend_kafka-ui-sdc.datxasia.com
    mode http
    balance roundrobin
    option httpchk GET /
    server datx-kafka-prod-05 10.0.129.68:8088

backend backend_node_core_notification_service
    mode http
    balance roundrobin
    option httpchk GET /api/health-check
    server k8s-prod01-worker01 10.48.14.21:31015 check
    server k8s-prod01-worker02 10.48.14.22:31015 check
    server k8s-prod01-worker03 10.48.14.23:31015 check
    server k8s-prod01-worker04 10.48.14.24:31015 check

# backend backend_schema_registry
#     mode http
#     balance roundrobin
#     option httpchk GET /
#     server k8s-prod01-worker01 10.48.14.21:32007
#     server k8s-prod01-worker02 10.48.14.22:32007
#     server k8s-prod01-worker03 10.48.14.23:32007
#     server k8s-prod01-worker04 10.48.14.24:32007

backend letsencrypt-backend
    mode http
    balance roundrobin
    option httpchk GET /
    server letsencrypt 127.0.0.1:8888 check

#Ingress Nginx
backend backend_prod_ingress_nginx_http
    mode http
    balance roundrobin
    server k8s-prod01-worker01 10.48.14.21:80 check
    server k8s-prod01-worker02 10.48.14.22:80 check
    server k8s-prod01-worker03 10.48.14.23:80 check
    server k8s-prod01-worker04 10.48.14.24:80 check

backend backend_prod_ingress_nginx_https
    mode http
    balance roundrobin
    server k8s-prod01-worker01 10.48.14.21:443 verify none
    server k8s-prod01-worker02 10.48.14.22:443 verify none
    server k8s-prod01-worker03 10.48.14.23:443 verify none
    server k8s-prod01-worker04 10.48.14.24:443 verify none
